---
layout: null
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫ÁîüÈáçÂºÄÊ®°ÊãüÂô® - Dec20B</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .back-link:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.3);
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .subtitle {
            color: #8e9aaf;
            font-size: 16px;
            font-weight: 500;
        }

        .game-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .game-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Â±ûÊÄßÂ∏ÉÂ±Ä - ‰∏ÄË°åÊòæÁ§∫ */
        .attributes-container {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .attribute-item {
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            padding: 15px 12px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            text-align: center;
            flex: 1;
            min-width: 130px;
            transition: all 0.3s ease;
        }

        .attribute-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .attribute-name {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .attribute-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .attr-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .attr-btn.minus {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
        }

        .attr-btn.plus {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .attr-btn:hover:not(:disabled) {
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .attr-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .attribute-value {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            min-width: 25px;
        }

        .points-remaining {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .control-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            margin: 5px;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Á¥ßÂáëÁöÑÂΩìÂâçÁä∂ÊÄÅÊòæÁ§∫ */
        .current-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stat-mini {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 12px;
            border-radius: 15px;
            text-align: center;
            flex: 1;
            min-width: 70px;
            transition: all 0.3s ease;
        }

        .stat-mini:hover {
            transform: scale(1.05);
        }

        .stat-mini-label {
            font-size: 10px;
            opacity: 0.9;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-mini-value {
            font-size: 16px;
            font-weight: 700;
        }

        .life-events {
            background: linear-gradient(135deg, #f8f9fa, #f0f2f5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .life-events::-webkit-scrollbar {
            width: 6px;
        }

        .life-events::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .life-events::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }

        .life-events::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        .event-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            opacity: 0;
            animation: slideIn 0.6s ease forwards;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-age {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .event-age::before {
            content: "üìÖ";
            font-size: 12px;
        }

        .event-description {
            color: #2c3e50;
            line-height: 1.5;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .event-effects {
            font-size: 12px;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 6px 10px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 500;
        }

        .loading-indicator {
            text-align: center;
            color: #8e9aaf;
            font-style: italic;
            padding: 20px;
        }

        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .achievements {
            background: linear-gradient(135deg, #fff9e6, #fff3d3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .achievement-item {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700;
            font-size: 14px;
            color: #2c3e50;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .achievement-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .progress-bar {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .age-indicator {
            text-align: center;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 25px;
                margin: 10px;
                margin-top: 60px;
            }

            .title {
                font-size: 2em;
            }

            .attributes-container {
                flex-direction: column;
                gap: 10px;
            }

            .attribute-item {
                min-width: auto;
            }

            .current-stats {
                flex-wrap: wrap;
                gap: 6px;
            }

            .stat-mini {
                min-width: 60px;
                padding: 8px 10px;
            }

            .back-link {
                top: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 12px;
            }

            .life-events {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <a href="/game/" class="back-link">‚Üê Ê∏∏Êàè‰∏≠ÂøÉ</a>

    <div class="game-container">
        <div class="header">
            <h1 class="title">‰∫∫ÁîüÈáçÂºÄÊ®°ÊãüÂô®</h1>
            <p class="subtitle">‰ΩìÈ™å‰∏çÂêåÁöÑ‰∫∫ÁîüËΩ®ËøπÔºåÁúãÁúãÂëΩËøê‰ºöÂ¶Ç‰ΩïÂÆâÊéí</p>
        </div>

        <!-- Â±ûÊÄßÂàÜÈÖçÈò∂ÊÆµ -->
        <div class="game-section active" id="attributeSection">
            <div class="section-title">üéØ ÂàÜÈÖç‰Ω†ÁöÑÂàùÂßãÂ±ûÊÄß</div>
            <div class="points-remaining">
                Ââ©‰ΩôÁÇπÊï∞: <span id="remainingPoints">20</span> / 20
            </div>
            
            <div class="attributes-container">
                <div class="attribute-item">
                    <div class="attribute-name">üß† Êô∫Âäõ</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('intelligence', -1)">‚àí</button>
                        <div class="attribute-value" id="intelligence">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('intelligence', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">üí™ ‰ΩìË¥®</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('constitution', -1)">‚àí</button>
                        <div class="attribute-value" id="constitution">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('constitution', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">üòä Âø´‰πê</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('happiness', -1)">‚àí</button>
                        <div class="attribute-value" id="happiness">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('happiness', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">üé® È≠ÖÂäõ</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('charm', -1)">‚àí</button>
                        <div class="attribute-value" id="charm">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('charm', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="control-buttons">
                <button class="btn secondary" onclick="randomAttributes()">üé≤ ÈöèÊú∫ÂàÜÈÖç</button>
                <button class="btn" id="startLifeBtn" onclick="startLife()" disabled>üöÄ ÂºÄÂßã‰∫∫Áîü</button>
            </div>
        </div>

        <!-- ‰∫∫ÁîüÊ®°ÊãüÈò∂ÊÆµ -->
        <div class="game-section" id="lifeSection">
            <div class="section-title">üìñ ‰Ω†ÁöÑ‰∫∫ÁîüËΩ®Ëøπ</div>
            
            <div class="age-indicator">
                ‰∫∫ÁîüËøõÂ∫¶: <span id="ageProgress">0</span> / 80 Â≤Å
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="current-stats" id="currentStats">
                <div class="stat-mini">
                    <div class="stat-mini-label">Âπ¥ÈæÑ</div>
                    <div class="stat-mini-value" id="currentAge">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">Êô∫Âäõ</div>
                    <div class="stat-mini-value" id="currentIntelligence">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">‰ΩìË¥®</div>
                    <div class="stat-mini-value" id="currentConstitution">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">Âø´‰πê</div>
                    <div class="stat-mini-value" id="currentHappiness">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">È≠ÖÂäõ</div>
                    <div class="stat-mini-value" id="currentCharm">0</div>
                </div>
            </div>

            <div class="life-events" id="lifeEvents">
                <div class="loading-indicator">‰∫∫ÁîüÂç≥Â∞ÜÂºÄÂßã...</div>
            </div>
            
            <div class="control-buttons">
                <button class="btn secondary" onclick="pauseLife()" id="pauseBtn" style="display: none;">‚è∏Ô∏è ÊöÇÂÅú</button>
                <button class="btn secondary" onclick="resumeLife()" id="resumeBtn" style="display: none;">‚ñ∂Ô∏è ÁªßÁª≠</button>
                <button class="btn" onclick="skipToEnd()" id="skipBtn">‚è≠Ô∏è Ë∑≥Âà∞ÁªìÂ∞æ</button>
                <button class="btn" onclick="showResults()" style="display: none;" id="showResultsBtn">üìä Êü•Áúã‰∫∫ÁîüÊÄªÁªì</button>
            </div>
        </div>

        <!-- ÁªìÊûúÂ±ïÁ§∫Èò∂ÊÆµ -->
        <div class="game-section" id="resultsSection">
            <div class="section-title">üèÜ ‰∫∫ÁîüÊÄªÁªì</div>
            
            <div class="final-stats" id="finalStats"></div>
            
            <div class="achievements" id="achievements">
                <div class="section-title">üéñÔ∏è Ëé∑ÂæóÊàêÂ∞±</div>
                <div id="achievementsList"></div>
            </div>

            <div class="control-buttons">
                <button class="btn" onclick="restartGame()">üîÑ ÈáçÂºÄ‰∫∫Áîü</button>
                <button class="btn secondary" onclick="quickRestart()">üé≤ ÈöèÊú∫ÈáçÂºÄ</button>
            </div>
        </div>
    </div>

    <script>
        class LifeRestartGame {
            constructor() {
                this.attributes = {
                    intelligence: 0,
                    constitution: 0,
                    happiness: 0,
                    charm: 0
                };
                this.remainingPoints = 20;
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set();
                this.achievements = [];
                this.isGameRunning = false;
                this.isPaused = false;
                this.maxAge = 80;
                this.gameSpeed = 1200; // Ë∞ÉÊï¥ÊòæÁ§∫ÈÄüÂ∫¶
                this.allEvents = [];
                this.eventsLoaded = false;
                this.loadEvents();
            }

            async loadEvents() {
                try {
                    const response = await fetch('/game/lifeEvents.txt');
                    if (!response.ok) {
                        throw new Error('Failed to load events file');
                    }
                    const text = await response.text();
                    const lines = text.split('\n').filter(line => line.trim() && line.includes('|'));
                    
                    console.log(`Âä†ËΩΩ‰∫Ü ${lines.length} ‰∏™‰∫ã‰ª∂`);
                    
                    this.allEvents = lines.map((line, index) => {
                        try {
                            const parts = line.split('|');
                            if (parts.length < 2) {
                                console.warn(`‰∫ã‰ª∂Ê†ºÂºèÈîôËØØ (Ë°å ${index + 1}): ${line}`);
                                return null;
                            }
                            
                            const [ageRange, description, effects] = parts;
                            const [minAge, maxAge] = ageRange.split('-').map(Number);
                            
                            const effectsObj = {};
                            if (effects && effects.trim()) {
                                effects.split(',').forEach(effect => {
                                    const [attr, value] = effect.split(':');
                                    if (attr && value) {
                                        effectsObj[attr.trim()] = parseInt(value);
                                    }
                                });
                            }
                            
                            return {
                                minAge: minAge || 0,
                                maxAge: maxAge || 80,
                                text: description.trim(),
                                effects: effectsObj,
                                id: `event_${index}_${minAge}_${maxAge}`
                            };
                        } catch (error) {
                            console.warn(`Ëß£Êûê‰∫ã‰ª∂Â§±Ë¥• (Ë°å ${index + 1}): ${line}`, error);
                            return null;
                        }
                    }).filter(event => event !== null);
                    
                    this.eventsLoaded = true;
                    console.log(`ÊàêÂäüÂä†ËΩΩ ${this.allEvents.length} ‰∏™ÊúâÊïà‰∫ã‰ª∂`);
                } catch (error) {
                    console.error('Âä†ËΩΩ‰∫ã‰ª∂Êñá‰ª∂Â§±Ë¥•:', error);
                    this.loadDefaultEvents();
                }
            }

            loadDefaultEvents() {
                console.log('‰ΩøÁî®ÈªòËÆ§‰∫ã‰ª∂Êï∞ÊçÆ');
                this.allEvents = [
                    {minAge: 0, maxAge: 10, text: "‰Ω†Âá∫Áîü‰∫ÜÔºÅÂÆ∂‰∫∫ÈÉΩÂæàÈ´òÂÖ¥„ÄÇ", effects: {happiness: 1}, id: "birth"},
                    {minAge: 1, maxAge: 10, text: "‰Ω†Â≠¶‰ºö‰∫ÜËµ∞Ë∑ØÔºåÂÆ∂‰∫∫‰∏∫‰Ω†ÊÑüÂà∞È™ÑÂÇ≤„ÄÇ", effects: {constitution: 1, happiness: 1}, id: "walk"},
                    {minAge: 2, maxAge: 10, text: "‰Ω†ÂºÄÂßãËØ¥ËØùÔºåÊòæÁ§∫Âá∫ËØ≠Ë®ÄÂ§©Ëµã„ÄÇ", effects: {intelligence: 1, charm: 1}, id: "talk"},
                    {minAge: 3, maxAge: 10, text: "‰Ω†Âú®ÂπºÂÑøÂõ≠‰∫§Âà∞‰∫ÜÊúãÂèã„ÄÇ", effects: {happiness: 2, charm: 1}, id: "friend"},
                    {minAge: 5, maxAge: 15, text: "‰Ω†Â≠¶‰ºö‰∫ÜÈ™ëËá™Ë°åËΩ¶„ÄÇ", effects: {constitution: 1, happiness: 2}, id: "bike"},
                    {minAge: 11, maxAge: 18, text: "‰Ω†ËøõÂÖ•‰∫Ü‰∏≠Â≠¶ÔºåÂ≠¶‰π†ÂéãÂäõÂ¢ûÂ§ß„ÄÇ", effects: {intelligence: 1, happiness: -1}, id: "school"},
                    {minAge: 15, maxAge: 25, text: "‰Ω†ÂºÄÂßãÂ≠¶‰π†ÁºñÁ®ã„ÄÇ", effects: {intelligence: 2, happiness: 1}, id: "programming"},
                    {minAge: 19, maxAge: 30, text: "‰Ω†ËøõÂÖ•‰∫ÜÂ§ßÂ≠¶„ÄÇ", effects: {intelligence: 2, happiness: 2}, id: "university"},
                    {minAge: 22, maxAge: 35, text: "‰Ω†ÊâæÂà∞‰∫ÜÁ¨¨‰∏Ä‰ªΩÂ∑•‰Ωú„ÄÇ", effects: {intelligence: 1, happiness: 2}, id: "job"},
                    {minAge: 25, maxAge: 40, text: "‰Ω†ÂºÄÂßã‰∫ÜÊÅãÁà±ÂÖ≥Á≥ª„ÄÇ", effects: {happiness: 3, charm: 1}, id: "love"},
                    {minAge: 30, maxAge: 50, text: "‰Ω†Âú®‰∫ã‰∏ö‰∏äÂèñÂæóÁ™ÅÁ†¥„ÄÇ", effects: {intelligence: 2, happiness: 3}, id: "career"},
                    {minAge: 35, maxAge: 55, text: "‰Ω†ÁªìÂ©ö‰∫Ü„ÄÇ", effects: {happiness: 4, charm: 1}, id: "marriage"},
                    {minAge: 40, maxAge: 60, text: "‰Ω†Êúâ‰∫ÜÂ≠©Â≠ê„ÄÇ", effects: {happiness: 3, constitution: -1}, id: "children"},
                    {minAge: 55, maxAge: 80, text: "‰Ω†ÂºÄÂßã‰∫´ÂèóÈÄÄ‰ºëÁîüÊ¥ª„ÄÇ", effects: {happiness: 2, constitution: -1}, id: "retire"},
                    {minAge: 60, maxAge: 80, text: "‰Ω†Êàê‰∏∫‰∫ÜÁ•ñÁà∂ÊØç„ÄÇ", effects: {happiness: 3}, id: "grandparent"}
                ];
                this.eventsLoaded = true;
                console.log(`Âä†ËΩΩ‰∫Ü ${this.allEvents.length} ‰∏™ÈªòËÆ§‰∫ã‰ª∂`);
            }

            init() {
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
            }

            changeAttribute(attr, delta) {
                if (delta > 0 && this.remainingPoints <= 0) return;
                if (delta < 0 && this.attributes[attr] <= 0) return;
                if (delta > 0 && this.attributes[attr] >= 10) return;

                this.attributes[attr] += delta;
                this.remainingPoints -= delta;

                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
            }

            randomAttributes() {
                this.attributes = {intelligence: 0, constitution: 0, happiness: 0, charm: 0};
                let points = 20;
                
                const attrs = Object.keys(this.attributes);
                while (points > 0) {
                    const attr = attrs[Math.floor(Math.random() * attrs.length)];
                    if (this.attributes[attr] < 10) {
                        this.attributes[attr]++;
                        points--;
                    }
                }
                
                this.remainingPoints = 0;
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
            }

            updateAttributeDisplay() {
                Object.keys(this.attributes).forEach(attr => {
                    document.getElementById(attr).textContent = this.attributes[attr];
                });
            }

            updatePointsDisplay() {
                document.getElementById('remainingPoints').textContent = this.remainingPoints;
                document.getElementById('startLifeBtn').disabled = this.remainingPoints > 0;
            }

            updateButtonStates() {
                Object.keys(this.attributes).forEach(attr => {
                    const container = document.querySelector(`#${attr}`).parentElement;
                    const minusBtn = container.querySelector('.minus');
                    const plusBtn = container.querySelector('.plus');
                    
                    minusBtn.disabled = this.attributes[attr] <= 0;
                    plusBtn.disabled = this.remainingPoints <= 0 || this.attributes[attr] >= 10;
                });
            }

            async startLife() {
                if (this.remainingPoints > 0) return;
                
                // Á≠âÂæÖ‰∫ã‰ª∂Âä†ËΩΩÂÆåÊàê
                while (!this.eventsLoaded) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                this.showSection('lifeSection');
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set(); // ÈáçÊñ∞ÂàùÂßãÂåñÔºåÁ°Æ‰øùÊ∏ÖÁ©∫
                this.isGameRunning = true;
                this.isPaused = false;
                
                // Ê∏ÖÁ©∫‰∫ã‰ª∂ÂÆπÂô®
                const eventsContainer = document.getElementById('lifeEvents');
                eventsContainer.innerHTML = '<div class="loading-indicator">‰∫∫ÁîüÂºÄÂßã‰∫Ü...</div>';
                
                console.log(`ÂºÄÂßãÊñ∞‰∫∫ÁîüÔºåÂÖ±Êúâ ${this.allEvents.length} ‰∏™‰∫ã‰ª∂ÂèØÁî®`);
                
                this.updateCurrentStats();
                this.updateProgress();
                
                // ÊòæÁ§∫ÊéßÂà∂ÊåâÈíÆ
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('skipBtn').style.display = 'inline-block';
                document.getElementById('showResultsBtn').style.display = 'none';
                
                setTimeout(() => this.simulateLife(), 1000);
            }

            simulateLife() {
                if (!this.isGameRunning || this.isPaused) return;
                
                if (this.age >= this.maxAge || this.attributes.constitution <= 0) {
                    this.endLife();
                    return;
                }

                this.age++;
                
                // Ëá™ÁÑ∂ÂèòÂåñ
                this.applyAging();
                
                // Á°Æ‰øùÊØèÂπ¥ÈÉΩÊúâ‰∫ã‰ª∂ - ‰øÆÂ§çË∑≥Ë∑ÉÈóÆÈ¢ò
                let event = this.getRandomEvent();
                if (!event) {
                    // Â¶ÇÊûúÊ≤°Êúâ‰∏ìÈó®ÁöÑ‰∫ã‰ª∂ÔºåÂàõÂª∫ÈÄöÁî®‰∫ã‰ª∂
                    const genericEvents = this.getGenericEventsForAge(this.age);
                    event = genericEvents[Math.floor(Math.random() * genericEvents.length)];
                }
                
                this.processEvent(event);
                this.updateCurrentStats();
                this.updateProgress();
                
                if (this.isGameRunning && !this.isPaused) {
                    setTimeout(() => this.simulateLife(), this.gameSpeed);
                }
            }

            applyAging() {
                if (this.age > 40) {
                    this.attributes.constitution = Math.max(0, this.attributes.constitution - 0.03);
                }
                
                if (this.age > 60) {
                    this.attributes.constitution = Math.max(0, this.attributes.constitution - 0.05);
                }
                
                // Â∞èÂπÖÈöèÊú∫ÂèòÂåñ
                if (Math.random() < 0.2) {
                    const attrs = Object.keys(this.attributes);
                    const attr = attrs[Math.floor(Math.random() * attrs.length)];
                    const change = (Math.random() - 0.5) * 0.1;
                    this.attributes[attr] = Math.max(0, Math.min(10, this.attributes[attr] + change));
                }
            }

            getRandomEvent() {
                const availableEvents = this.allEvents.filter(event => 
                    this.age >= event.minAge && 
                    this.age <= event.maxAge && 
                    !this.usedEvents.has(event.id)
                );
                
                if (availableEvents.length === 0) {
                    return null;
                }
                
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                this.usedEvents.add(event.id);
                return event;
            }

            getGenericEventsForAge(age) {
                const genericEvents = [];
                
                if (age <= 10) {
                    genericEvents.push(
                        {text: "‰Ω†Âú®Áé©ËÄç‰∏≠Â≠¶Âà∞‰∫ÜÊñ∞‰∏úË•ø„ÄÇ", effects: {intelligence: 0.5, happiness: 1}, id: `generic_child_${age}`},
                        {text: "‰Ω†ÂíåÂ∞èÊúãÂèã‰ª¨‰∏ÄËµ∑Â∫¶Ëøá‰∫ÜÂø´‰πêÁöÑÊó∂ÂÖâ„ÄÇ", effects: {happiness: 1, charm: 0.5}, id: `generic_play_${age}`},
                        {text: "‰Ω†‰ªäÂ§©ÁâπÂà´‰πñÔºåÂæóÂà∞‰∫ÜÂÆ∂‰∫∫ÁöÑË°®Êâ¨„ÄÇ", effects: {happiness: 1, charm: 0.5}, id: `generic_good_${age}`}
                    );
                } else if (age <= 18) {
                    genericEvents.push(
                        {text: "‰Ω†Âú®Â≠¶Ê†°Â∫¶Ëøá‰∫ÜÂπ≥Â∏∏ÁöÑ‰∏ÄÂ§©„ÄÇ", effects: {intelligence: 0.5}, id: `generic_school_${age}`},
                        {text: "‰Ω†ÂíåÊúãÂèã‰ª¨‰∏ÄËµ∑ËÆ®ËÆ∫‰∫ÜÊúâË∂£ÁöÑËØùÈ¢ò„ÄÇ", effects: {charm: 0.5, happiness: 1}, id: `generic_friend_${age}`},
                        {text: "‰Ω†Âú®Â≠¶‰π†‰∏äÂèñÂæó‰∫ÜÂ∞èÂ∞èÁöÑËøõÊ≠•„ÄÇ", effects: {intelligence: 1, happiness: 0.5}, id: `generic_study_${age}`}
                    );
                } else if (age <= 30) {
                    genericEvents.push(
                        {text: "‰Ω†Âú®Â∑•‰Ωú‰∏≠ÁßØÁ¥Ø‰∫ÜÊõ¥Â§öÁªèÈ™å„ÄÇ", effects: {intelligence: 1}, id: `generic_work_${age}`},
                        {text: "‰Ω†ÂíåÊúãÂèã‰ª¨ËÅöÈ§êÔºåËÅä‰∫ÜÂæàÂ§ö„ÄÇ", effects: {happiness: 1, charm: 0.5}, id: `generic_social_${age}`},
                        {text: "‰Ω†Â≠¶‰ºö‰∫Ü‰∏Ä‰∏™Â∞èÊäÄËÉΩ„ÄÇ", effects: {intelligence: 0.5, happiness: 0.5}, id: `generic_skill_${age}`}
                    );
                } else if (age <= 50) {
                    genericEvents.push(
                        {text: "‰Ω†Âú®ÂÆ∂Â∫≠ÂíåÂ∑•‰Ωú‰∏≠ÊâæÂà∞‰∫ÜÂπ≥Ë°°„ÄÇ", effects: {happiness: 1}, id: `generic_balance_${age}`},
                        {text: "‰Ω†‰∏∫ÂÆ∂Â∫≠‰ªòÂá∫‰∫ÜÂæàÂ§öÂä™Âäõ„ÄÇ", effects: {constitution: -0.5, happiness: 1}, id: `generic_family_${age}`},
                        {text: "‰Ω†Âú®‰∫ã‰∏ö‰∏äÁ®≥Ê≠•ÂèëÂ±ï„ÄÇ", effects: {intelligence: 0.5, charm: 0.5}, id: `generic_career_${age}`}
                    );
                } else {
                    genericEvents.push(
                        {text: "‰Ω†‰∫´ÂèóÁùÄÂÆÅÈùôÁöÑÈÄÄ‰ºëÁîüÊ¥ª„ÄÇ", effects: {happiness: 1, constitution: -0.3}, id: `generic_retire_${age}`},
                        {text: "‰Ω†ÂíåÂÆ∂‰∫∫Â∫¶Ëøá‰∫ÜÊ∏©È¶®ÁöÑÊó∂ÂÖâ„ÄÇ", effects: {happiness: 2}, id: `generic_family_time_${age}`},
                        {text: "‰Ω†ÂõûÂøÜËµ∑‰∫∫Áîü‰∏≠ÁöÑÁæéÂ•ΩÊó∂Âàª„ÄÇ", effects: {happiness: 1}, id: `generic_memory_${age}`}
                    );
                }
                
                return genericEvents;
            }

            processEvent(event) {
                let effectsText = [];
                if (event.effects && Object.keys(event.effects).length > 0) {
                    Object.keys(event.effects).forEach(attr => {
                        if (this.attributes[attr] !== undefined) {
                            const oldValue = this.attributes[attr];
                            this.attributes[attr] = Math.max(0, Math.min(10, 
                                this.attributes[attr] + event.effects[attr]));
                            
                            const change = Math.round((this.attributes[attr] - oldValue) * 10) / 10;
                            if (Math.abs(change) > 0.05) {
                                const attrNames = {
                                    intelligence: 'Êô∫Âäõ',
                                    constitution: '‰ΩìË¥®', 
                                    happiness: 'Âø´‰πê',
                                    charm: 'È≠ÖÂäõ'
                                };
                                effectsText.push(`${attrNames[attr]}${change > 0 ? '+' : ''}${change}`);
                            }
                        }
                    });
                }

                // Ê∏ÖÁ©∫Âä†ËΩΩÊèêÁ§∫
                const eventsContainer = document.getElementById('lifeEvents');
                if (eventsContainer.querySelector('.loading-indicator')) {
                    eventsContainer.innerHTML = '';
                }

                // Ê∑ªÂä†‰∫ã‰ª∂Âà∞ÂàóË°®
                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.innerHTML = `
                    <div class="event-age">${this.age}Â≤Å</div>
                    <div class="event-description">${event.text}</div>
                    ${effectsText.length > 0 ? `<div class="event-effects">${effectsText.join(', ')}</div>` : ''}
                `;
                
                eventsContainer.appendChild(eventElement);
                eventsContainer.scrollTop = eventsContainer.scrollHeight;

                this.lifeEvents.push({age: this.age, text: event.text, effects: effectsText});
            }

            updateCurrentStats() {
                document.getElementById('currentAge').textContent = this.age;
                document.getElementById('currentIntelligence').textContent = Math.round(this.attributes.intelligence * 10) / 10;
                document.getElementById('currentConstitution').textContent = Math.round(this.attributes.constitution * 10) / 10;
                document.getElementById('currentHappiness').textContent = Math.round(this.attributes.happiness * 10) / 10;
                document.getElementById('currentCharm').textContent = Math.round(this.attributes.charm * 10) / 10;
            }

            updateProgress() {
                const progress = (this.age / this.maxAge) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('ageProgress').textContent = this.age;
            }

            pauseLife() {
                this.isPaused = true;
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resumeBtn').style.display = 'inline-block';
            }

            resumeLife() {
                this.isPaused = false;
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('resumeBtn').style.display = 'none';
                this.simulateLife();
            }

            skipToEnd() {
                this.isGameRunning = false;
                this.isPaused = false;
                this.endLife();
            }

            endLife() {
                this.isGameRunning = false;
                this.isPaused = false;
                
                // ÈöêËóèÊéßÂà∂ÊåâÈíÆ
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resumeBtn').style.display = 'none';
                document.getElementById('skipBtn').style.display = 'none';
                document.getElementById('showResultsBtn').style.display = 'inline-block';
                
                // Â¶ÇÊûúÂπ¥ÈæÑÂ§™Â∞èÔºåËÆæÁΩÆ‰∏∫Ëá™ÁÑ∂Ê≠ª‰∫°Âπ¥ÈæÑ
                if (this.age < 60 && this.attributes.constitution > 0) {
                    this.age = Math.min(this.maxAge, this.age + Math.floor(Math.random() * 20) + 10);
                }
                
                this.calculateAchievements();
                this.updateProgress();
                this.updateCurrentStats();
            }

            calculateAchievements() {
                this.achievements = [];
                
                if (this.age >= 80) this.achievements.push("üéÇ ÈïøÂØøËÄÖ - Ê¥ªÂà∞‰∫Ü80Â≤Å");
                if (this.age <= 30) this.achievements.push("‚ö∞Ô∏è Ëã±Âπ¥Êó©ÈÄù - ‰∫∫ÁîüÂ§™Áü≠ÊöÇ");
                
                if (this.attributes.intelligence >= 8) this.achievements.push("üß† Êô∫ËÄÖ - Êã•ÊúâË∂ÖÈ´òÊô∫Âäõ");
                if (this.attributes.constitution >= 8) this.achievements.push("üí™ Âº∫ËÄÖ - Êã•ÊúâÂº∫ÂÅ•‰ΩìÈ≠Ñ");
                if (this.attributes.happiness >= 8) this.achievements.push("üòä ‰πêËßÇËÄÖ - ‰øùÊåÅÂø´‰πêÂøÉÊÄÅ");
                if (this.attributes.charm >= 8) this.achievements.push("üåü È≠ÖÂäõ‰πãÊòü - Êã•ÊúâË∂ÖÂá°È≠ÖÂäõ");
                
                const totalStats = Object.values(this.attributes).reduce((sum, val) => sum + val, 0);
                if (totalStats >= 32) this.achievements.push("üèÜ ‰∫∫ÁîüËµ¢ÂÆ∂ - ÂÖ®Èù¢ÂèëÂ±ï");
                if (totalStats <= 8) this.achievements.push("üòî Âπ≥Âá°‰∏ÄÁîü - ÊôÆÊôÆÈÄöÈÄö");
                
                if (this.lifeEvents.length >= 40) this.achievements.push("üìö ÁªèÂéÜ‰∏∞ÂØå - ‰∫∫ÁîüÂ§öÂßøÂ§öÂΩ©");
                if (this.age >= 70 && this.attributes.happiness >= 7) this.achievements.push("üòå ÊôöÂπ¥Âπ∏Á¶è - ÂÆâ‰∫´ÊôöÂπ¥");
                
                // ÁâπÊÆäÊàêÂ∞±
                if (this.attributes.intelligence >= 9) this.achievements.push("üéì Â§©Êâç - Êô∫ÂäõË∂ÖÁæ§");
                if (this.attributes.constitution >= 9) this.achievements.push("üèÉ ÈìÅ‰∫∫ - ‰ΩìË¥®Ë∂ÖÂá°");
                if (this.attributes.happiness >= 9) this.achievements.push("üåà Âø´‰πêÊ∫êÊ≥â - Ê∞∏Ëøú‰πêËßÇ");
                if (this.attributes.charm >= 9) this.achievements.push("üëë È≠ÖÂäõÁéãËÄÖ - ‰∫∫ËßÅ‰∫∫Áà±");
            }

            showResults() {
                this.showSection('resultsSection');
                
                const finalStats = document.getElementById('finalStats');
                finalStats.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">‰∫´Âπ¥</div>
                        <div class="stat-value">${this.age}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Êô∫Âäõ</div>
                        <div class="stat-value">${Math.round(this.attributes.intelligence * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‰ΩìË¥®</div>
                        <div class="stat-value">${Math.round(this.attributes.constitution * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Âø´‰πê</div>
                        <div class="stat-value">${Math.round(this.attributes.happiness * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">È≠ÖÂäõ</div>
                        <div class="stat-value">${Math.round(this.attributes.charm * 10) / 10}</div>
                    </div>
                `;

                const achievementsList = document.getElementById('achievementsList');
                if (this.achievements.length > 0) {
                    achievementsList.innerHTML = this.achievements.map(achievement => 
                        `<div class="achievement-item">${achievement}</div>`
                    ).join('');
                } else {
                    achievementsList.innerHTML = '<div class="achievement-item">ü§∑ ÊöÇÊó†ÊàêÂ∞± - ÂÜçËØï‰∏ÄÊ¨°Âêß</div>';
                }
            }

            showSection(sectionId) {
                document.querySelectorAll('.game-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
            }

            restartGame() {
                this.attributes = {intelligence: 0, constitution: 0, happiness: 0, charm: 0};
                this.remainingPoints = 20;
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set(); // ÈáçÊñ∞ÂàùÂßãÂåñ
                this.achievements = [];
                this.isGameRunning = false;
                this.isPaused = false;
                
                this.showSection('attributeSection');
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
                
                console.log('Ê∏∏ÊàèÈáçÂêØÔºå‰∫ã‰ª∂Ê±†Â∑≤ÈáçÁΩÆ');
            }

            quickRestart() {
                this.restartGame();
                this.randomAttributes();
                setTimeout(() => this.startLife(), 500);
            }
        }

        let game;

        function changeAttribute(attr, delta) {
            game.changeAttribute(attr, delta);
        }

        function randomAttributes() {
            game.randomAttributes();
        }

        function startLife() {
            game.startLife();
        }

        function pauseLife() {
            game.pauseLife();
        }

        function resumeLife() {
            game.resumeLife();
        }

        function skipToEnd() {
            game.skipToEnd();
        }

        function showResults() {
            game.showResults();
        }

        function restartGame() {
            game.restartGame();
        }

        function quickRestart() {
            game.quickRestart();
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        window.addEventListener('load', () => {
            game = new LifeRestartGame();
            game.init();
        });
    </script>
</body>
</html> 