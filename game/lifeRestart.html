---
layout: null
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿé‡å¼€æ¨¡æ‹Ÿå™¨ - Dec20B</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .back-link:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.3);
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .subtitle {
            color: #8e9aaf;
            font-size: 16px;
            font-weight: 500;
        }

        .game-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .game-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å±æ€§å¸ƒå±€ - ä¸€è¡Œæ˜¾ç¤º */
        .attributes-container {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .attribute-item {
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            padding: 15px 12px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            text-align: center;
            flex: 1;
            min-width: 130px;
            transition: all 0.3s ease;
        }

        .attribute-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .attribute-name {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .attribute-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .attr-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .attr-btn.minus {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
        }

        .attr-btn.plus {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .attr-btn:hover:not(:disabled) {
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .attr-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .attribute-value {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            min-width: 25px;
        }

        .points-remaining {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .control-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            margin: 5px;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ç´§å‡‘çš„å½“å‰çŠ¶æ€æ˜¾ç¤º */
        .current-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stat-mini {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 12px;
            border-radius: 15px;
            text-align: center;
            flex: 1;
            min-width: 70px;
            transition: all 0.3s ease;
        }

        .stat-mini:hover {
            transform: scale(1.05);
        }

        .stat-mini-label {
            font-size: 10px;
            opacity: 0.9;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-mini-value {
            font-size: 16px;
            font-weight: 700;
        }

        .life-events {
            background: linear-gradient(135deg, #f8f9fa, #f0f2f5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .life-events::-webkit-scrollbar {
            width: 6px;
        }

        .life-events::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .life-events::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }

        .life-events::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        .event-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            opacity: 0;
            animation: slideIn 0.6s ease forwards;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-age {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .event-age::before {
            content: "ğŸ“…";
            font-size: 12px;
        }

        .event-description {
            color: #2c3e50;
            line-height: 1.5;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .event-effects {
            font-size: 12px;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 6px 10px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 500;
        }

        .loading-indicator {
            text-align: center;
            color: #8e9aaf;
            font-style: italic;
            padding: 20px;
        }

        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .achievements {
            background: linear-gradient(135deg, #fff9e6, #fff3d3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .achievement-item {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700;
            font-size: 14px;
            color: #2c3e50;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .achievement-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .progress-bar {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .age-indicator {
            text-align: center;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 25px;
                margin: 10px;
                margin-top: 60px;
            }

            .title {
                font-size: 2em;
            }

            .attributes-container {
                flex-direction: column;
                gap: 10px;
            }

            .attribute-item {
                min-width: auto;
            }

            .current-stats {
                flex-wrap: wrap;
                gap: 6px;
            }

            .stat-mini {
                min-width: 60px;
                padding: 8px 10px;
            }

            .back-link {
                top: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 12px;
            }

            .life-events {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <a href="/game/" class="back-link">â† æ¸¸æˆä¸­å¿ƒ</a>

    <div class="game-container">
        <div class="header">
            <h1 class="title">äººç”Ÿé‡å¼€æ¨¡æ‹Ÿå™¨</h1>
            <p class="subtitle">ä½“éªŒä¸åŒçš„äººç”Ÿè½¨è¿¹ï¼Œçœ‹çœ‹å‘½è¿ä¼šå¦‚ä½•å®‰æ’</p>
        </div>

        <!-- å±æ€§åˆ†é…é˜¶æ®µ -->
        <div class="game-section active" id="attributeSection">
            <div class="section-title">ğŸ¯ åˆ†é…ä½ çš„åˆå§‹å±æ€§</div>
            <div class="points-remaining">
                å‰©ä½™ç‚¹æ•°: <span id="remainingPoints">20</span> / 20
            </div>
            
            <div class="attributes-container">
                <div class="attribute-item">
                    <div class="attribute-name">ğŸ§  æ™ºåŠ›</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('intelligence', -1)">âˆ’</button>
                        <div class="attribute-value" id="intelligence">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('intelligence', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">ğŸ’ª ä½“è´¨</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('constitution', -1)">âˆ’</button>
                        <div class="attribute-value" id="constitution">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('constitution', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">ğŸ˜Š å¿«ä¹</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('happiness', -1)">âˆ’</button>
                        <div class="attribute-value" id="happiness">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('happiness', 1)">+</button>
                    </div>
                </div>

                <div class="attribute-item">
                    <div class="attribute-name">ğŸ¨ é­…åŠ›</div>
                    <div class="attribute-controls">
                        <button class="attr-btn minus" onclick="changeAttribute('charm', -1)">âˆ’</button>
                        <div class="attribute-value" id="charm">0</div>
                        <button class="attr-btn plus" onclick="changeAttribute('charm', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="control-buttons">
                <button class="btn secondary" onclick="randomAttributes()">ğŸ² éšæœºåˆ†é…</button>
                <button class="btn" id="startLifeBtn" onclick="startLife()" disabled>ğŸš€ å¼€å§‹äººç”Ÿ</button>
            </div>
        </div>

        <!-- äººç”Ÿæ¨¡æ‹Ÿé˜¶æ®µ -->
        <div class="game-section" id="lifeSection">
            <div class="section-title">ğŸ“– ä½ çš„äººç”Ÿè½¨è¿¹</div>
            
            <div class="age-indicator">
                äººç”Ÿè¿›åº¦: <span id="ageProgress">0</span> / 80 å²
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="current-stats" id="currentStats">
                <div class="stat-mini">
                    <div class="stat-mini-label">å¹´é¾„</div>
                    <div class="stat-mini-value" id="currentAge">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">æ™ºåŠ›</div>
                    <div class="stat-mini-value" id="currentIntelligence">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">ä½“è´¨</div>
                    <div class="stat-mini-value" id="currentConstitution">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">å¿«ä¹</div>
                    <div class="stat-mini-value" id="currentHappiness">0</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-mini-label">é­…åŠ›</div>
                    <div class="stat-mini-value" id="currentCharm">0</div>
                </div>
            </div>

            <div class="life-events" id="lifeEvents">
                <div class="loading-indicator">äººç”Ÿå³å°†å¼€å§‹...</div>
            </div>
            
            <div class="control-buttons">
                <button class="btn secondary" onclick="pauseLife()" id="pauseBtn" style="display: none;">â¸ï¸ æš‚åœ</button>
                <button class="btn secondary" onclick="resumeLife()" id="resumeBtn" style="display: none;">â–¶ï¸ ç»§ç»­</button>
                <button class="btn" onclick="skipToEnd()" id="skipBtn">â­ï¸ è·³åˆ°ç»“å°¾</button>
                <button class="btn" onclick="showResults()" style="display: none;" id="showResultsBtn">ğŸ“Š æŸ¥çœ‹äººç”Ÿæ€»ç»“</button>
            </div>
        </div>

        <!-- ç»“æœå±•ç¤ºé˜¶æ®µ -->
        <div class="game-section" id="resultsSection">
            <div class="section-title">ğŸ† äººç”Ÿæ€»ç»“</div>
            
            <div class="final-stats" id="finalStats"></div>
            
            <div class="achievements" id="achievements">
                <div class="section-title">ğŸ–ï¸ è·å¾—æˆå°±</div>
                <div id="achievementsList"></div>
            </div>

            <div class="control-buttons">
                <button class="btn" onclick="restartGame()">ğŸ”„ é‡å¼€äººç”Ÿ</button>
                <button class="btn secondary" onclick="quickRestart()">ğŸ² éšæœºé‡å¼€</button>
            </div>
        </div>
    </div>

    <script>
        class LifeRestartGame {
            constructor() {
                this.attributes = {
                    intelligence: 0,
                    constitution: 0,
                    happiness: 0,
                    charm: 0
                };
                this.remainingPoints = 20;
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set();
                this.achievements = [];
                this.isGameRunning = false;
                this.isPaused = false;
                this.maxAge = 80;
                this.gameSpeed = 1200; // è°ƒæ•´æ˜¾ç¤ºé€Ÿåº¦
                this.allEvents = [];
                this.eventsLoaded = false;
                this.loadEvents();
            }

            async loadEvents() {
                try {
                    const response = await fetch('/game/lifeEvents.txt');
                    if (!response.ok) {
                        throw new Error('Failed to load events file');
                    }
                    const text = await response.text();
                    const lines = text.split('\n').filter(line => line.trim() && line.includes('|'));
                    
                    console.log(`åŠ è½½äº† ${lines.length} ä¸ªäº‹ä»¶`);
                    
                    this.allEvents = lines.map((line, index) => {
                        try {
                            const parts = line.split('|');
                            if (parts.length < 2) {
                                console.warn(`äº‹ä»¶æ ¼å¼é”™è¯¯ (è¡Œ ${index + 1}): ${line}`);
                                return null;
                            }
                            
                            const [ageRange, description, effects] = parts;
                            const [minAge, maxAge] = ageRange.split('-').map(Number);
                            
                            const effectsObj = {};
                            if (effects && effects.trim()) {
                                effects.split(',').forEach(effect => {
                                    const [attr, value] = effect.split(':');
                                    if (attr && value) {
                                        effectsObj[attr.trim()] = parseInt(value);
                                    }
                                });
                            }
                            
                            return {
                                minAge: minAge || 0,
                                maxAge: maxAge || 80,
                                text: description.trim(),
                                effects: effectsObj,
                                id: `event_${index}_${minAge}_${maxAge}`
                            };
                        } catch (error) {
                            console.warn(`è§£æäº‹ä»¶å¤±è´¥ (è¡Œ ${index + 1}): ${line}`, error);
                            return null;
                        }
                    }).filter(event => event !== null);
                    
                    this.eventsLoaded = true;
                    console.log(`æˆåŠŸåŠ è½½ ${this.allEvents.length} ä¸ªæœ‰æ•ˆäº‹ä»¶`);
                } catch (error) {
                    console.error('åŠ è½½äº‹ä»¶æ–‡ä»¶å¤±è´¥:', error);
                    this.loadDefaultEvents();
                }
            }

            loadDefaultEvents() {
                console.log('ä½¿ç”¨é»˜è®¤äº‹ä»¶æ•°æ®');
                this.allEvents = [
                    {minAge: 0, maxAge: 10, text: "ä½ å‡ºç”Ÿäº†ï¼å®¶äººéƒ½å¾ˆé«˜å…´ã€‚", effects: {happiness: 1}, id: "birth"},
                    {minAge: 1, maxAge: 10, text: "ä½ å­¦ä¼šäº†èµ°è·¯ï¼Œå®¶äººä¸ºä½ æ„Ÿåˆ°éª„å‚²ã€‚", effects: {constitution: 1, happiness: 1}, id: "walk"},
                    {minAge: 2, maxAge: 10, text: "ä½ å¼€å§‹è¯´è¯ï¼Œæ˜¾ç¤ºå‡ºè¯­è¨€å¤©èµ‹ã€‚", effects: {intelligence: 1, charm: 1}, id: "talk"},
                    {minAge: 3, maxAge: 10, text: "ä½ åœ¨å¹¼å„¿å›­äº¤åˆ°äº†æœ‹å‹ã€‚", effects: {happiness: 2, charm: 1}, id: "friend"},
                    {minAge: 5, maxAge: 15, text: "ä½ å­¦ä¼šäº†éª‘è‡ªè¡Œè½¦ã€‚", effects: {constitution: 1, happiness: 2}, id: "bike"},
                    {minAge: 11, maxAge: 18, text: "ä½ è¿›å…¥äº†ä¸­å­¦ï¼Œå­¦ä¹ å‹åŠ›å¢å¤§ã€‚", effects: {intelligence: 1, happiness: -1}, id: "school"},
                    {minAge: 15, maxAge: 25, text: "ä½ å¼€å§‹å­¦ä¹ ç¼–ç¨‹ã€‚", effects: {intelligence: 2, happiness: 1}, id: "programming"},
                    {minAge: 19, maxAge: 30, text: "ä½ è¿›å…¥äº†å¤§å­¦ã€‚", effects: {intelligence: 2, happiness: 2}, id: "university"},
                    {minAge: 22, maxAge: 35, text: "ä½ æ‰¾åˆ°äº†ç¬¬ä¸€ä»½å·¥ä½œã€‚", effects: {intelligence: 1, happiness: 2}, id: "job"},
                    {minAge: 25, maxAge: 40, text: "ä½ å¼€å§‹äº†æ‹çˆ±å…³ç³»ã€‚", effects: {happiness: 3, charm: 1}, id: "love"},
                    {minAge: 30, maxAge: 50, text: "ä½ åœ¨äº‹ä¸šä¸Šå–å¾—çªç ´ã€‚", effects: {intelligence: 2, happiness: 3}, id: "career"},
                    {minAge: 35, maxAge: 55, text: "ä½ ç»“å©šäº†ã€‚", effects: {happiness: 4, charm: 1}, id: "marriage"},
                    {minAge: 40, maxAge: 60, text: "ä½ æœ‰äº†å­©å­ã€‚", effects: {happiness: 3, constitution: -1}, id: "children"},
                    {minAge: 55, maxAge: 80, text: "ä½ å¼€å§‹äº«å—é€€ä¼‘ç”Ÿæ´»ã€‚", effects: {happiness: 2, constitution: -1}, id: "retire"},
                    {minAge: 60, maxAge: 80, text: "ä½ æˆä¸ºäº†ç¥–çˆ¶æ¯ã€‚", effects: {happiness: 3}, id: "grandparent"}
                ];
                this.eventsLoaded = true;
                console.log(`åŠ è½½äº† ${this.allEvents.length} ä¸ªé»˜è®¤äº‹ä»¶`);
            }

            init() {
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
            }

            changeAttribute(attr, delta) {
                if (delta > 0 && this.remainingPoints <= 0) return;
                if (delta < 0 && this.attributes[attr] <= 0) return;
                if (delta > 0 && this.attributes[attr] >= 10) return;

                this.attributes[attr] += delta;
                this.remainingPoints -= delta;

                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
            }

            randomAttributes() {
                this.attributes = {intelligence: 0, constitution: 0, happiness: 0, charm: 0};
                let points = 20;
                
                const attrs = Object.keys(this.attributes);
                while (points > 0) {
                    const attr = attrs[Math.floor(Math.random() * attrs.length)];
                    if (this.attributes[attr] < 10) {
                        this.attributes[attr]++;
                        points--;
                    }
                }
                
                this.remainingPoints = 0;
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
            }

            updateAttributeDisplay() {
                Object.keys(this.attributes).forEach(attr => {
                    document.getElementById(attr).textContent = this.attributes[attr];
                });
            }

            updatePointsDisplay() {
                document.getElementById('remainingPoints').textContent = this.remainingPoints;
                document.getElementById('startLifeBtn').disabled = this.remainingPoints > 0;
            }

            updateButtonStates() {
                Object.keys(this.attributes).forEach(attr => {
                    const container = document.querySelector(`#${attr}`).parentElement;
                    const minusBtn = container.querySelector('.minus');
                    const plusBtn = container.querySelector('.plus');
                    
                    minusBtn.disabled = this.attributes[attr] <= 0;
                    plusBtn.disabled = this.remainingPoints <= 0 || this.attributes[attr] >= 10;
                });
            }

            async startLife() {
                if (this.remainingPoints > 0) return;
                
                // ç­‰å¾…äº‹ä»¶åŠ è½½å®Œæˆ
                while (!this.eventsLoaded) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                this.showSection('lifeSection');
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set(); // é‡æ–°åˆå§‹åŒ–ï¼Œç¡®ä¿æ¸…ç©º
                this.isGameRunning = true;
                this.isPaused = false;
                
                // æ¸…ç©ºäº‹ä»¶å®¹å™¨
                const eventsContainer = document.getElementById('lifeEvents');
                eventsContainer.innerHTML = '<div class="loading-indicator">äººç”Ÿå¼€å§‹äº†...</div>';
                
                console.log(`å¼€å§‹æ–°äººç”Ÿï¼Œå…±æœ‰ ${this.allEvents.length} ä¸ªäº‹ä»¶å¯ç”¨`);
                
                this.updateCurrentStats();
                this.updateProgress();
                
                // æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('skipBtn').style.display = 'inline-block';
                document.getElementById('showResultsBtn').style.display = 'none';
                
                setTimeout(() => this.simulateLife(), 1000);
            }

            simulateLife() {
                if (!this.isGameRunning || this.isPaused) return;
                
                if (this.age >= this.maxAge || this.attributes.constitution <= 0) {
                    this.endLife();
                    return;
                }

                this.age++;
                
                // è‡ªç„¶å˜åŒ–
                this.applyAging();
                
                // ç¡®ä¿æ¯å¹´éƒ½æœ‰äº‹ä»¶ - ä¿®å¤è·³è·ƒé—®é¢˜
                let event = this.getRandomEvent();
                if (!event) {
                    // å¦‚æœæ²¡æœ‰ä¸“é—¨çš„äº‹ä»¶ï¼Œåˆ›å»ºé€šç”¨äº‹ä»¶
                    const genericEvents = this.getGenericEventsForAge(this.age);
                    event = genericEvents[Math.floor(Math.random() * genericEvents.length)];
                }
                
                this.processEvent(event);
                this.updateCurrentStats();
                this.updateProgress();
                
                if (this.isGameRunning && !this.isPaused) {
                    setTimeout(() => this.simulateLife(), this.gameSpeed);
                }
            }

            applyAging() {
                if (this.age > 40) {
                    this.attributes.constitution = Math.max(0, this.attributes.constitution - 0.03);
                }
                
                if (this.age > 60) {
                    this.attributes.constitution = Math.max(0, this.attributes.constitution - 0.05);
                }
                
                // å°å¹…éšæœºå˜åŒ–
                if (Math.random() < 0.2) {
                    const attrs = Object.keys(this.attributes);
                    const attr = attrs[Math.floor(Math.random() * attrs.length)];
                    const change = (Math.random() - 0.5) * 0.1;
                    this.attributes[attr] = Math.max(0, Math.min(10, this.attributes[attr] + change));
                }
            }

            getRandomEvent() {
                const availableEvents = this.allEvents.filter(event => 
                    this.age >= event.minAge && 
                    this.age <= event.maxAge && 
                    !this.usedEvents.has(event.id)
                );
                
                if (availableEvents.length === 0) {
                    return null;
                }
                
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                this.usedEvents.add(event.id);
                return event;
            }

            getGenericEventsForAge(age) {
                const genericEvents = [];
                
                if (age <= 10) {
                    genericEvents.push(
                        {text: "ä½ åœ¨ç©è€ä¸­å­¦åˆ°äº†æ–°ä¸œè¥¿ã€‚", effects: {intelligence: 0.5, happiness: 1}, id: `generic_child_${age}`},
                        {text: "ä½ å’Œå°æœ‹å‹ä»¬ä¸€èµ·åº¦è¿‡äº†å¿«ä¹çš„æ—¶å…‰ã€‚", effects: {happiness: 1, charm: 0.5}, id: `generic_play_${age}`},
                        {text: "ä½ ä»Šå¤©ç‰¹åˆ«ä¹–ï¼Œå¾—åˆ°äº†å®¶äººçš„è¡¨æ‰¬ã€‚", effects: {happiness: 1, charm: 0.5}, id: `generic_good_${age}`}
                    );
                } else if (age <= 18) {
                    genericEvents.push(
                        {text: "ä½ åœ¨å­¦æ ¡åº¦è¿‡äº†å¹³å¸¸çš„ä¸€å¤©ã€‚", effects: {intelligence: 0.5}, id: `generic_school_${age}`},
                        {text: "ä½ å’Œæœ‹å‹ä»¬ä¸€èµ·è®¨è®ºäº†æœ‰è¶£çš„è¯é¢˜ã€‚", effects: {charm: 0.5, happiness: 1}, id: `generic_friend_${age}`},
                        {text: "ä½ åœ¨å­¦ä¹ ä¸Šå–å¾—äº†å°å°çš„è¿›æ­¥ã€‚", effects: {intelligence: 1, happiness: 0.5}, id: `generic_study_${age}`}
                    );
                } else if (age <= 30) {
                    genericEvents.push(
                        {text: "ä½ åœ¨å·¥ä½œä¸­ç§¯ç´¯äº†æ›´å¤šç»éªŒã€‚", effects: {intelligence: 1}, id: `generic_work_${age}`},
                        {text: "ä½ å’Œæœ‹å‹ä»¬èšé¤ï¼ŒèŠäº†å¾ˆå¤šã€‚", effects: {happiness: 1, charm: 0.5}, id: `generic_social_${age}`},
                        {text: "ä½ å­¦ä¼šäº†ä¸€ä¸ªå°æŠ€èƒ½ã€‚", effects: {intelligence: 0.5, happiness: 0.5}, id: `generic_skill_${age}`}
                    );
                } else if (age <= 50) {
                    genericEvents.push(
                        {text: "ä½ åœ¨å®¶åº­å’Œå·¥ä½œä¸­æ‰¾åˆ°äº†å¹³è¡¡ã€‚", effects: {happiness: 1}, id: `generic_balance_${age}`},
                        {text: "ä½ ä¸ºå®¶åº­ä»˜å‡ºäº†å¾ˆå¤šåŠªåŠ›ã€‚", effects: {constitution: -0.5, happiness: 1}, id: `generic_family_${age}`},
                        {text: "ä½ åœ¨äº‹ä¸šä¸Šç¨³æ­¥å‘å±•ã€‚", effects: {intelligence: 0.5, charm: 0.5}, id: `generic_career_${age}`}
                    );
                } else {
                    genericEvents.push(
                        {text: "ä½ äº«å—ç€å®é™çš„é€€ä¼‘ç”Ÿæ´»ã€‚", effects: {happiness: 1, constitution: -0.3}, id: `generic_retire_${age}`},
                        {text: "ä½ å’Œå®¶äººåº¦è¿‡äº†æ¸©é¦¨çš„æ—¶å…‰ã€‚", effects: {happiness: 2}, id: `generic_family_time_${age}`},
                        {text: "ä½ å›å¿†èµ·äººç”Ÿä¸­çš„ç¾å¥½æ—¶åˆ»ã€‚", effects: {happiness: 1}, id: `generic_memory_${age}`}
                    );
                }
                
                return genericEvents;
            }

            processEvent(event) {
                let effectsText = [];
                if (event.effects && Object.keys(event.effects).length > 0) {
                    Object.keys(event.effects).forEach(attr => {
                        if (this.attributes[attr] !== undefined) {
                            const oldValue = this.attributes[attr];
                            this.attributes[attr] = Math.max(0, Math.min(10, 
                                this.attributes[attr] + event.effects[attr]));
                            
                            const change = Math.round((this.attributes[attr] - oldValue) * 10) / 10;
                            if (Math.abs(change) > 0.05) {
                                const attrNames = {
                                    intelligence: 'æ™ºåŠ›',
                                    constitution: 'ä½“è´¨', 
                                    happiness: 'å¿«ä¹',
                                    charm: 'é­…åŠ›'
                                };
                                effectsText.push(`${attrNames[attr]}${change > 0 ? '+' : ''}${change}`);
                            }
                        }
                    });
                }

                // æ¸…ç©ºåŠ è½½æç¤º
                const eventsContainer = document.getElementById('lifeEvents');
                if (eventsContainer.querySelector('.loading-indicator')) {
                    eventsContainer.innerHTML = '';
                }

                // æ·»åŠ äº‹ä»¶åˆ°åˆ—è¡¨
                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.innerHTML = `
                    <div class="event-age">${this.age}å²</div>
                    <div class="event-description">${event.text}</div>
                    ${effectsText.length > 0 ? `<div class="event-effects">${effectsText.join(', ')}</div>` : ''}
                `;
                
                eventsContainer.appendChild(eventElement);
                eventsContainer.scrollTop = eventsContainer.scrollHeight;

                this.lifeEvents.push({age: this.age, text: event.text, effects: effectsText});
            }

            updateCurrentStats() {
                document.getElementById('currentAge').textContent = this.age;
                document.getElementById('currentIntelligence').textContent = Math.round(this.attributes.intelligence * 10) / 10;
                document.getElementById('currentConstitution').textContent = Math.round(this.attributes.constitution * 10) / 10;
                document.getElementById('currentHappiness').textContent = Math.round(this.attributes.happiness * 10) / 10;
                document.getElementById('currentCharm').textContent = Math.round(this.attributes.charm * 10) / 10;
            }

            updateProgress() {
                const progress = (this.age / this.maxAge) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('ageProgress').textContent = this.age;
            }

            pauseLife() {
                this.isPaused = true;
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resumeBtn').style.display = 'inline-block';
            }

            resumeLife() {
                this.isPaused = false;
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('resumeBtn').style.display = 'none';
                this.simulateLife();
            }

            skipToEnd() {
                this.isGameRunning = false;
                this.isPaused = false;
                this.endLife();
            }

            endLife() {
                this.isGameRunning = false;
                this.isPaused = false;
                
                // éšè—æ§åˆ¶æŒ‰é’®
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resumeBtn').style.display = 'none';
                document.getElementById('skipBtn').style.display = 'none';
                document.getElementById('showResultsBtn').style.display = 'inline-block';
                
                // å¦‚æœå¹´é¾„å¤ªå°ï¼Œè®¾ç½®ä¸ºè‡ªç„¶æ­»äº¡å¹´é¾„
                if (this.age < 60 && this.attributes.constitution > 0) {
                    this.age = Math.min(this.maxAge, this.age + Math.floor(Math.random() * 20) + 10);
                }
                
                this.calculateAchievements();
                this.updateProgress();
                this.updateCurrentStats();
            }

            calculateAchievements() {
                this.achievements = [];
                
                if (this.age >= 80) this.achievements.push("ğŸ‚ é•¿å¯¿è€… - æ´»åˆ°äº†80å²");
                if (this.age <= 30) this.achievements.push("âš°ï¸ è‹±å¹´æ—©é€ - äººç”Ÿå¤ªçŸ­æš‚");
                
                if (this.attributes.intelligence >= 8) this.achievements.push("ğŸ§  æ™ºè€… - æ‹¥æœ‰è¶…é«˜æ™ºåŠ›");
                if (this.attributes.constitution >= 8) this.achievements.push("ğŸ’ª å¼ºè€… - æ‹¥æœ‰å¼ºå¥ä½“é­„");
                if (this.attributes.happiness >= 8) this.achievements.push("ğŸ˜Š ä¹è§‚è€… - ä¿æŒå¿«ä¹å¿ƒæ€");
                if (this.attributes.charm >= 8) this.achievements.push("ğŸŒŸ é­…åŠ›ä¹‹æ˜Ÿ - æ‹¥æœ‰è¶…å‡¡é­…åŠ›");
                
                const totalStats = Object.values(this.attributes).reduce((sum, val) => sum + val, 0);
                if (totalStats >= 32) this.achievements.push("ğŸ† äººç”Ÿèµ¢å®¶ - å…¨é¢å‘å±•");
                if (totalStats <= 8) this.achievements.push("ğŸ˜” å¹³å‡¡ä¸€ç”Ÿ - æ™®æ™®é€šé€š");
                
                if (this.lifeEvents.length >= 40) this.achievements.push("ğŸ“š ç»å†ä¸°å¯Œ - äººç”Ÿå¤šå§¿å¤šå½©");
                if (this.age >= 70 && this.attributes.happiness >= 7) this.achievements.push("ğŸ˜Œ æ™šå¹´å¹¸ç¦ - å®‰äº«æ™šå¹´");
                
                // ç‰¹æ®Šæˆå°±
                if (this.attributes.intelligence >= 9) this.achievements.push("ğŸ“ å¤©æ‰ - æ™ºåŠ›è¶…ç¾¤");
                if (this.attributes.constitution >= 9) this.achievements.push("ğŸƒ é“äºº - ä½“è´¨è¶…å‡¡");
                if (this.attributes.happiness >= 9) this.achievements.push("ğŸŒˆ å¿«ä¹æºæ³‰ - æ°¸è¿œä¹è§‚");
                if (this.attributes.charm >= 9) this.achievements.push("ğŸ‘‘ é­…åŠ›ç‹è€… - äººè§äººçˆ±");
            }

            showResults() {
                this.showSection('resultsSection');
                
                const finalStats = document.getElementById('finalStats');
                finalStats.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">äº«å¹´</div>
                        <div class="stat-value">${this.age}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ™ºåŠ›</div>
                        <div class="stat-value">${Math.round(this.attributes.intelligence * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä½“è´¨</div>
                        <div class="stat-value">${Math.round(this.attributes.constitution * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¿«ä¹</div>
                        <div class="stat-value">${Math.round(this.attributes.happiness * 10) / 10}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">é­…åŠ›</div>
                        <div class="stat-value">${Math.round(this.attributes.charm * 10) / 10}</div>
                    </div>
                `;

                const achievementsList = document.getElementById('achievementsList');
                if (this.achievements.length > 0) {
                    achievementsList.innerHTML = this.achievements.map(achievement => 
                        `<div class="achievement-item">${achievement}</div>`
                    ).join('');
                } else {
                    achievementsList.innerHTML = '<div class="achievement-item">ğŸ¤· æš‚æ— æˆå°± - å†è¯•ä¸€æ¬¡å§</div>';
                }
            }

            showSection(sectionId) {
                document.querySelectorAll('.game-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
            }

            restartGame() {
                this.attributes = {intelligence: 0, constitution: 0, happiness: 0, charm: 0};
                this.remainingPoints = 20;
                this.age = 0;
                this.lifeEvents = [];
                this.usedEvents = new Set(); // é‡æ–°åˆå§‹åŒ–
                this.achievements = [];
                this.isGameRunning = false;
                this.isPaused = false;
                
                this.showSection('attributeSection');
                this.updateAttributeDisplay();
                this.updatePointsDisplay();
                this.updateButtonStates();
                
                console.log('æ¸¸æˆé‡å¯ï¼Œäº‹ä»¶æ± å·²é‡ç½®');
            }

            quickRestart() {
                this.restartGame();
                this.randomAttributes();
                setTimeout(() => this.startLife(), 500);
            }
        }

        let game;

        function changeAttribute(attr, delta) {
            game.changeAttribute(attr, delta);
        }

        function randomAttributes() {
            game.randomAttributes();
        }

        function startLife() {
            game.startLife();
        }

        function pauseLife() {
            game.pauseLife();
        }

        function resumeLife() {
            game.resumeLife();
        }

        function skipToEnd() {
            game.skipToEnd();
        }

        function showResults() {
            game.showResults();
        }

        function restartGame() {
            game.restartGame();
        }

        function quickRestart() {
            game.quickRestart();
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('load', () => {
            game = new LifeRestartGame();
            game.init();
        });
    </script>
</body>
</html> 